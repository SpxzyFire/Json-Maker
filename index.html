<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-adsense-account" content="ca-pub-6213603518465024" />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6213603518465024"
      crossorigin="anonymous"
    ></script>
    <link
      rel="icon"
      href="https://cdn.glitch.global/d52a6415-826b-4b02-82db-e300df7a8506/Logo?v=1747925805307"
      type="image/png"
    />
    <title>Animal Company Item Forge</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background: #f0f4f8;
        color: #333;
        min-height: 100vh;
        padding: 20px;
        overflow-x: hidden;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
      }

      h1 {
        font-size: 2.5rem;
        color: #2c3e50;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .tab-bar {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .tab-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        background: #3498db;
        color: #fff;
        text-transform: uppercase;
        transition: background 0.3s ease;
      }

      .tab-btn:hover {
        background: #2980b9;
      }

      .tab-btn.active {
        background: #e74c3c;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .home-content {
        text-align: center;
        background: #fff;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .home-content h2 {
        font-size: 1.8rem;
        color: #2c3e50;
        margin-bottom: 15px;
      }

      .home-content p {
        font-size: 1.1rem;
        line-height: 1.6;
        max-width: 800px;
        margin: 0 auto;
        color: #7f8c8d;
      }

      .block-builder-content {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        animation: fadeIn 0.5s ease-in-out;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .equipment-grid {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        min-width: 300px;
      }

      .slot {
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      .slot:hover {
        transform: scale(1.02);
      }

      .slot h4 {
        font-size: 1.1rem;
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .slot div {
        font-size: 0.9rem;
        color: #95a5a6;
      }

      .slot .item {
        color: #2c3e50;
        font-weight: 600;
      }

      .slot .remove-btn,
      .slot .view-btn {
        margin-top: 10px;
        padding: 5px 10px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: background 0.3s ease;
      }

      .slot .remove-btn {
        background: #e74c3c;
        color: #fff;
        margin-right: 5px;
      }

      .slot .remove-btn:hover {
        background: #c0392b;
      }

      .slot .view-btn {
        background: #3498db;
        color: #fff;
      }

      .slot .view-btn:hover {
        background: #2980b9;
      }

      .slot.selected {
        border: 2px solid #3498db;
        box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
      }

      .add-item-section {
        flex: 1;
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        min-width: 250px;
      }

      .add-item-section h3,
      .properties-section h3 {
        font-size: 1.2rem;
        margin-bottom: 15px;
        color: #2c3e50;
      }

      .preset-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .preset-btn {
        padding: 8px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
        color: #fff;
        transition: background 0.3s ease;
      }

      .preset-btn.heart-gun {
        background: #ff6b6b;
      }

      .preset-btn.heart-gun:hover {
        background: #ff4d4d;
      }

      .preset-btn.crossbow {
        background: #ffa500;
      }

      .preset-btn.crossbow:hover {
        background: #e69500;
      }

      .preset-btn.bag {
        background: #1abc9c;
      }

      .preset-btn.bag:hover {
        background: #16a085;
      }

      .search-bar {
        margin-bottom: 15px;
      }

      .search-bar input {
        width: 100%;
        padding: 10px;
        border: 1px solid #dfe6e9;
        border-radius: 5px;
        font-size: 0.9rem;
        background: #f9fbfc;
        transition: border-color 0.3s ease;
      }

      .search-bar input:focus {
        outline: none;
        border-color: #3498db;
      }

      .item-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #dfe6e9;
        border-radius: 5px;
        padding: 5px;
        background: #f9fbfc;
      }

      .item-list div {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #eceff1;
        font-size: 0.9rem;
        color: #2c3e50;
        transition: background 0.2s ease;
      }

      .item-list div:hover {
        background: #ecf0f1;
      }

      .properties-section {
        flex: 1;
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        min-width: 250px;
      }

      .color-presets {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-bottom: 15px;
      }

      .color-preset {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        padding: 5px;
        border-radius: 5px;
        transition: background 0.2s ease;
      }

      .color-preset:hover {
        background: #ecf0f1;
      }

      .color-circle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 1px solid #dfe6e9;
      }

      .color-circle.galaxy1 { background: #6b4e9b; }
      .color-circle.galaxy2 { background: #4a3575; }
      .color-circle.gold1 { background: #ffd700; }
      .color-circle.diamond1 { background: #66e0ff; }
      .color-circle.diamond2 { background: #33c7ff; }
      .color-circle.ruby1 { background: #ff4040; }

      .property-group {
        margin-bottom: 15px;
      }

      .property-group label {
        display: block;
        font-size: 0.9rem;
        margin-bottom: 5px;
        color: #7f8c8d;
      }

      .property-group input[type="range"] {
        width: 100%;
        accent-color: #3498db;
      }

      .property-group input[type="number"] {
        width: 60px;
        padding: 5px;
        border: 1px solid #dfe6e9;
        border-radius: 5px;
        font-size: 0.9rem;
        margin-left: 10px;
      }

      .property-group .input-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .editor-container {
        margin-top: 20px;
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .editor-container h3 {
        font-size: 1.2rem;
        margin-bottom: 15px;
        color: #2c3e50;
      }

      .editor-settings {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-bottom: 15px;
        padding: 10px;
        background: #f9fbfc;
        border-radius: 5px;
      }

      .editor {
        height: 400px;
        border: 1px solid #dfe6e9;
        border-radius: 5px;
      }

      .editor-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 15px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 0.9rem;
        cursor: pointer;
        background: #3498db;
        color: #fff;
        transition: background 0.3s ease;
      }

      .btn:hover {
        background: #2980b9;
      }

      .input-group {
        margin-bottom: 10px;
      }

      .input-group label {
        font-size: 0.9rem;
        color: #7f8c8d;
        margin-right: 10px;
      }

      .input-group select,
      .input-group input[type="number"] {
        padding: 5px;
        border: 1px solid #dfe6e9;
        border-radius: 5px;
        font-size: 0.9rem;
        background: #f9fbfc;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      .modal-content h3 {
        font-size: 1.3rem;
        margin-bottom: 15px;
        color: #2c3e50;
      }

      .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 1.5rem;
        cursor: pointer;
        color: #e74c3c;
      }

      .backpack-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
        margin-bottom: 15px;
      }

      .backpack-option {
        background: #f9fbfc;
        border: 1px solid #dfe6e9;
        border-radius: 5px;
        padding: 10px;
        text-align: center;
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .backpack-option:hover {
        background: #ecf0f1;
      }

      .backpack-slots {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
      }

      .backpack-slot {
        background: #f9fbfc;
        border: 1px solid #dfe6e9;
        border-radius: 5px;
        padding: 10px;
        text-align: center;
      }

      .backpack-slot div {
        font-size: 0.9rem;
        color: #95a5a6;
        margin-bottom: 5px;
      }

      .nested-item-properties {
        margin-top: 15px;
      }

      .loading-screen {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #fff;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        flex-direction: column;
        gap: 10px;
      }

      .loading-spinner {
        border: 4px solid #dfe6e9;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .loading-screen p {
        font-size: 1.1rem;
        color: #2c3e50;
      }

      footer {
        text-align: center;
        padding: 15px 0;
        color: #7f8c8d;
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        .block-builder-content {
          flex-direction: column;
        }

        .equipment-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .backpack-slots {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        .equipment-grid {
          grid-template-columns: 1fr;
        }

        .tab-bar {
          flex-direction: column;
          gap: 10px;
        }

        .editor-settings {
          grid-template-columns: 1fr;
        }

        .backpack-slots {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="loading-screen" id="loadingScreen">
      <div class="loading-spinner"></div>
      <p>Loading Item Forge...</p>
    </div>

    <div class="container">
      <header>
        <h1>Animal Company Item Forge</h1>
        <div class="tab-bar">
          <button class="tab-btn active" data-tab="home">Home</button>
          <button class="tab-btn" data-tab="blockBuilder">JSON Block Builder</button>
          <button class="tab-btn" data-tab="manualEditor">Manual Editor</button>
        </div>
      </header>

      <div id="home" class="tab-content home-content active">
        <h2>Welcome to the Animal Company Item Forge</h2>
        <p>
          The Animal Company Item Forge is a powerful tool designed for enthusiasts and modders of the Animal Company game. This web-based application allows you to create, customize, and manage item configurations with ease. Whether you're crafting complex item hierarchies or manually editing JSON data, this tool provides an intuitive interface to bring your ideas to life.
        </p>
        <p>
          With the JSON Block Builder, you can visually construct item slots, customize properties like hue, saturation, and scale, and manage your equipment. The Manual Editor offers a full-featured JSON editor with syntax highlighting and autocomplete, perfect for advanced users who prefer direct code manipulation. Export your creations as JSON files for use in the game.
        </p>
        <p>
          Get started by exploring the JSON Block Builder to create your item configurations or dive into the Manual Editor for precise JSON editing. Your creations are just a few clicks away!
        </p>
      </div>

      <div id="blockBuilder" class="tab-content">
        <div class="block-builder-content">
          <div class="equipment-grid">
            <div class="slot" data-slot="leftHand">
              <h4>Left Hand</h4>
              <div>Empty</div>
            </div>
            <div class="slot" data-slot="back">
              <h4>Back</h4>
              <div>Empty</div>
            </div>
            <div class="slot" data-slot="rightHand">
              <h4>Right Hand</h4>
              <div>Empty</div>
            </div>
            <div class="slot" data-slot="leftHip">
              <h4>Left Hip</h4>
              <div>Empty</div>
            </div>
            <div class="slot" data-slot="rightHip">
              <h4>Right Hip</h4>
              <div>Empty</div>
            </div>
          </div>

          <div class="add-item-section">
            <h3>Add Item</h3>
            <div class="preset-buttons">
              <button class="preset-btn heart-gun" onclick="addPresetItem('item_heart_gun')">Add Heart Gun</button>
              <button class="preset-btn crossbow" onclick="addPresetItem('item_crossbow')">Add Crossbow</button>
              <button class="preset-btn bag" onclick="openBackpackModal()">Add Bag</button>
            </div>
            <div class="search-bar">
              <input type="text" id="searchItemID" placeholder="Search items..." />
            </div>
            <div class="item-list" id="itemList"></div>
          </div>

          <div class="properties-section">
            <h3>Properties</h3>
            <div id="propertiesContent">Select an item to edit its properties</div>
            <div class="color-presets">
              <div class="color-preset" data-hue="270" data-sat="50">
                <div class="color-circle galaxy1"></div>
                <span>Galaxy 1</span>
              </div>
              <div class="color-preset" data-hue="260" data-sat="40">
                <div class="color-circle galaxy2"></div>
                <span>Galaxy 2</span>
              </div>
              <div class="color-preset" data-hue="50" data-sat="100">
                <div class="color-circle gold1"></div>
                <span>Gold 1</span>
              </div>
              <div class="color-preset" data-hue="195" data-sat="100">
                <div class="color-circle diamond1"></div>
                <span>Diamond 1</span>
              </div>
              <div class="color-preset" data-hue="195" data-sat="80">
                <div class="color-circle diamond2"></div>
                <span>Diamond 2</span>
              </div>
              <div class="color-preset" data-hue="0" data-sat="75">
                <div class="color-circle ruby1"></div>
                <span>Ruby 1</span>
              </div>
            </div>
          </div>
        </div>

        <div id="backpackModal" class="modal">
          <div class="modal-content">
            <span class="close-btn" onclick="closeModal('backpackModal')">×</span>
            <h3>Select Backpack</h3>
            <div class="backpack-list" id="backpackList"></div>
          </div>
        </div>

        <div id="contentModal" class="modal">
          <div class="modal-content">
            <span class="close-btn" onclick="closeModal('contentModal')">×</span>
            <h3 id="contentModalTitle"></h3>
            <div id="contentModalBody"></div>
          </div>
        </div>

        <div class="editor-container">
          <h3>JSON Output</h3>
          <div class="editor-settings">
            <div class="input-group">
              <label>Editor Theme</label>
              <select id="editorTheme">
                <option value="vs">Light</option>
                <option value="vs-dark">Dark</option>
                <option value="hc-black">High Contrast</option>
              </select>
            </div>
            <div class="input-group">
              <label>Font Size</label>
              <input type="number" id="fontSize" value="16" min="10" max="28" step="1" />
            </div>
            <div class="input-group">
              <label>Line Height</label>
              <input type="number" id="lineHeight" value="24" min="12" max="48" step="1" />
            </div>
            <div class="input-group">
              <label>Show Minimap</label>
              <select id="minimap">
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
            </div>
            <div class="input-group">
              <label>Line Numbers</label>
              <select id="lineNumbers">
                <option value="on">On</option>
                <option value="off">Off</option>
                <option value="relative">Relative</option>
              </select>
            </div>
            <div class="input-group">
              <label>Word Wrap</label>
              <select id="wordWrap">
                <option value="on">On</option>
                <option value="off">Off</option>
                <option value="wordWrapColumn">Column</option>
              </select>
            </div>
            <div class="input-group">
              <label>Auto Close Brackets</label>
              <select id="autoClosingBrackets">
                <option value="always">Always</option>
                <option value="languageDefined">Language Defined</option>
                <option value="beforeWhitespace">Before Whitespace</option>
                <option value="never">Never</option>
              </select>
            </div>
          </div>
          <div id="blockEditor" class="editor"></div>
          <div class="editor-buttons">
            <button class="btn" onclick="generateJSON()">Generate JSON</button>
            <button class="btn" onclick="downloadJSON()">Download JSON</button>
            <button class="btn" onclick="document.getElementById('jsonFileInput').click()">Import JSON</button>
          </div>
        </div>
        <input type="file" id="jsonFileInput" accept=".json" style="display: none" onchange="handleFileSelect(event)" />
      </div>

      <div id="manualEditor" class="tab-content">
        <div class="editor-container">
          <h3>Manual JSON Editor</h3>
          <div class="editor-settings">
            <div class="input-group">
              <label>Editor Theme</label>
              <select id="manualEditorTheme">
                <option value="vs">Light</option>
                <option value="vs-dark">Dark</option>
                <option value="hc-black">High Contrast</option>
              </select>
            </div>
            <div class="input-group">
              <label>Font Size</label>
              <input type="number" id="manualFontSize" value="16" min="10" max="28" step="1" />
            </div>
            <div class="input-group">
              <label>Line Height</label>
              <input type="number" id="manualLineHeight" value="24" min="12" max="48" step="1" />
            </div>
            <div class="input-group">
              <label>Show Minimap</label>
              <select id="manualMinimap">
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
            </div>
            <div class="input-group">
              <label>Line Numbers</label>
              <select id="manualLineNumbers">
                <option value="on">On</option>
                <option value="off">Off</option>
                <option value="relative">Relative</option>
              </select>
            </div>
            <div class="input-group">
              <label>Word Wrap</label>
              <select id="manualWordWrap">
                <option value="on">On</option>
                <option value="off">Off</option>
                <option value="wordWrapColumn">Column</option>
              </select>
            </div>
            <div class="input-group">
              <label>Auto Close Brackets</label>
              <select id="manualAutoClosingBrackets">
                <option value="always">Always</option>
                <option value="languageDefined">Language Defined</option>
                <option value="beforeWhitespace">Before Whitespace</option>
                <option value="never">Never</option>
              </select>
            </div>
          </div>
          <div id="manualEditor" class="editor"></div>
          <div class="editor-buttons">
            <button class="btn" onclick="downloadManualJSON()">Download JSON</button>
            <button class="btn" onclick="document.getElementById('manualJsonFileInput').click()">Import JSON</button>
          </div>
        </div>
        <input type="file" id="manualJsonFileInput" accept=".json" style="display: none" onchange="handleManualFileSelect(event)" />
      </div>

      <footer>Animal Company Item Forge © 2025</footer>
    </div>

    <script>
      const slots = ["back", "leftHand", "rightHand", "leftHip", "rightHip"];
      const itemData = {};
      let selectedSlot = null;
      let blockEditor, manualEditor;

      const itemIDs = [
        { id: "None", displayName: "None" },
        { id: "item_anti_gravity_grenade", displayName: "Anti Gravity Grenade" },
        { id: "item_apple", displayName: "Apple" },
        { id: "item_arrow", displayName: "Arrow" },
        { id: "item_arrow_heart", displayName: "Arrow Heart" },
        { id: "item_arrow_lightbulb", displayName: "Arrow Lightbulb" },
        { id: "item_backpack", displayName: "Backpack", capacity: 13 },
        { id: "item_backpack_black", displayName: "Backpack Black", capacity: 13 },
        { id: "item_backpack_green", displayName: "Backpack Green", capacity: 13 },
        { id: "item_backpack_large_base", displayName: "Backpack Large Base", capacity: 23 },
        { id: "item_backpack_large_basketball", displayName: "Backpack Large Basketball", capacity: 23 },
        { id: "item_backpack_large_clover", displayName: "Backpack Large Clover", capacity: 23 },
        { id: "item_backpack_pink", displayName: "Backpack Pink", capacity: 13 },
        { id: "item_backpack_small_base", displayName: "Backpack Small Base", capacity: 13 },
        { id: "item_backpack_white", displayName: "Backpack White", capacity: 13 },
        { id: "item_backpack_with_flashlight", displayName: "Backpack With Flashlight", capacity: 13 },
        { id: "item_balloon", displayName: "Balloon" },
        { id: "item_balloon_heart", displayName: "Balloon Heart" },
        { id: "item_banana", displayName: "Banana" },
        { id: "item_baseball_bat", displayName: "Baseball Bat" },
        { id: "item_big_cup", displayName: "Big Cup" },
        { id: "item_boombox", displayName: "Boombox" },
        { id: "item_boombox_neon", displayName: "Boombox Neon" },
        { id: "item_box_fan", displayName: "Box Fan" },
        { id: "item_calculator", displayName: "Calculator" },
        { id: "item_cardboard_box", displayName: "Cardboard Box" },
        { id: "item_cash", displayName: "Cash" },
        { id: "item_cash_mega_pile", displayName: "Cash Mega Pile" },
        { id: "item_cash_pile", displayName: "Cash Pile" },
        { id: "item_clapper", displayName: "Clapper" },
        { id: "item_cluster_grenade", displayName: "Cluster Grenade" },
        { id: "item_cola", displayName: "Cola" },
        { id: "item_cola_large", displayName: "Cola Large" },
        { id: "item_company_ration", displayName: "Company Ration" },
        { id: "item_company_ration_heal", displayName: "Company Ration Heal" },
        { id: "item_cracker", displayName: "Cracker" },
        { id: "item_crate", displayName: "Crate" },
        { id: "item_crossbow", displayName: "Crossbow" },
        { id: "item_crossbow_heart", displayName: "Crossbow Heart" },
        { id: "item_crowbar", displayName: "Crowbar" },
        { id: "item_disc", displayName: "Disc" },
        { id: "item_disposable_camera", displayName: "Disposable Camera" },
        { id: "item_dynamite", displayName: "Dynamite" },
        { id: "item_dynamite_cube", displayName: "Dynamite Cube" },
        { id: "item_egg", displayName: "Egg" },
        { id: "item_flaregun", displayName: "Flaregun" },
        { id: "item_flashbang", displayName: "Flashbang" },
        { id: "item_flashlight", displayName: "Flashlight" },
        { id: "item_flashlight_mega", displayName: "Flashlight Mega" },
        { id: "item_flashlight_red", displayName: "Flashlight Red" },
        { id: "item_floppy3", displayName: "Floppy 3" },
        { id: "item_floppy5", displayName: "Floppy 5" },
        { id: "item_football", displayName: "Football" },
        { id: "item_frying_pan", displayName: "Frying Pan" },
        { id: "item_glowstick", displayName: "Glowstick" },
        { id: "item_goldbar", displayName: "Gold Bar" },
        { id: "item_grenade", displayName: "Grenade" },
        { id: "item_heart_chunk", displayName: "Heart Chunk" },
        { id: "item_heart_gun", displayName: "Heart Gun" },
        { id: "item_heartchocolatebox", displayName: "Heart Chocolate Box" },
        { id: "item_hh_key", displayName: "HH Key" },
        { id: "item_hookshot", displayName: "Hookshot" },
        { id: "item_hoverpad", displayName: "Hoverpad" },
        { id: "item_impulse_grenade", displayName: "Impulse Grenade" },
        { id: "item_jetpack", displayName: "Jetpack" },
        { id: "item_keycard", displayName: "Keycard" },
        { id: "item_lance", displayName: "Lance" },
        { id: "item_large_banana", displayName: "Large Banana" },
        { id: "item_mug", displayName: "Mug" },
        { id: "item_nut", displayName: "Nut" },
        { id: "item_ogre_hands", displayName: "Ogre Hands" },
        { id: "item_ore_copper_l", displayName: "Ore Copper L" },
        { id: "item_ore_copper_m", displayName: "Ore Copper M" },
        { id: "item_ore_copper_s", displayName: "Ore Copper S" },
        { id: "item_ore_gold_l", displayName: "Ore Gold L" },
        { id: "item_ore_gold_m", displayName: "Ore Gold M" },
        { id: "item_ore_gold_s", displayName: "Ore Gold S" },
        { id: "item_ore_hell", displayName: "Ore Hell" },
        { id: "item_ore_silver_l", displayName: "Ore Silver L" },
        { id: "item_ore_silver_m", displayName: "Ore Silver M" },
        { id: "item_ore_silver_s", displayName: "Ore Silver S" },
        { id: "item_painting_canvas", displayName: "Painting Canvas" },
        { id: "item_paperpack", displayName: "Paper Pack" },
        { id: "item_pelican_case", displayName: "Pelican Case" },
        { id: "item_pickaxe", displayName: "Pickaxe" },
        { id: "item_pickaxe_cny", displayName: "Pickaxe CNY" },
        { id: "item_pickaxe_cube", displayName: "Pickaxe Cube" },
        { id: "item_pipe", displayName: "Pipe" },
        { id: "item_pinata_bat", displayName: "Pinata Bat" },
        { id: "item_plunger", displayName: "Plunger" },
        { id: "item_pogostick", displayName: "Pogo Stick" },
        { id: "item_police_baton", displayName: "Police Baton" },
        { id: "item_pumpkin_pie", displayName: "Pumpkin Pie" },
        { id: "item_pumpkinjack", displayName: "Pumpkin Jack" },
        { id: "item_pumpkinjack_small", displayName: "Pumpkin Jack Small" },
        { id: "item_quiver", displayName: "Quiver", capacity: 13 },
        { id: "item_quiver_heart", displayName: "Quiver Heart", capacity: 13 },
        { id: "item_radioactive_broccoli", displayName: "Radioactive Broccoli" },
        { id: "item_randombox_mobloot_big", displayName: "Random Box Mob Loot Big" },
        { id: "item_randombox_mobloot_medium", displayName: "Random Box Mob Loot Medium" },
        { id: "item_randombox_mobloot_small", displayName: "Random Box Mob Loot Small" },
        { id: "item_randombox_mobloot_weapons", displayName: "Random Box Mob Loot Weapons" },
        { id: "item_revolver", displayName: "Revolver" },
        { id: "item_revolver_ammo", displayName: "Revolver Ammo" },
        { id: "item_revolver_gold", displayName: "Revolver Gold" },
        { id: "item_rope", displayName: "Rope" },
        { id: "item_rpg", displayName: "RPG" },
        { id: "item_rpg_ammo", displayName: "RPG Ammo" },
        { id: "item_rpg_ammo_egg", displayName: "RPG Ammo Egg" },
        { id: "item_rpg_cny", displayName: "RPG CNY" },
        { id: "item_rpg_easter", displayName: "RPG Easter" },
        { id: "item_rubberducky", displayName: "Rubber Ducky" },
        { id: "item_ruby", displayName: "Ruby" },
        { id: "item_saddle", displayName: "Saddle" },
        { id: "item_scanner", displayName: "Scanner" },
        { id: "item_scissors", displayName: "Scissors" },
        { id: "item_shield", displayName: "Shield" },
        { id: "item_shield_bones", displayName: "Shield Bones" },
        { id: "item_shield_police", displayName: "Shield Police" },
        { id: "item_shotgun", displayName: "Shotgun" },
        { id: "item_shotgun_ammo", displayName: "Shotgun Ammo" },
        { id: "item_shredder", displayName: "Shredder" },
        { id: "item_shrinking_broccoli", displayName: "Shrinking Broccoli" },
        { id: "item_snowball", displayName: "Snowball" },
        { id: "item_stapler", displayName: "Stapler" },
        { id: "item_stick_armbones", displayName: "Stick Arm Bones" },
        { id: "item_stick_bone", displayName: "Stick Bone" },
        { id: "item_sticker_dispenser", displayName: "Sticker Dispenser" },
        { id: "item_sticky_dynamite", displayName: "Sticky Dynamite" },
        { id: "item_stinky_cheese", displayName: "Stinky Cheese" },
        { id: "item_tablet", displayName: "Tablet" },
        { id: "item_tapedispenser", displayName: "Tape Dispenser" },
        { id: "item_tele_grenade", displayName: "Tele Grenade" },
        { id: "item_theremin", displayName: "Theremin" },
        { id: "item_timebomb", displayName: "Time Bomb" },
        { id: "item_toilet_paper", displayName: "Toilet Paper" },
        { id: "item_toilet_paper_mega", displayName: "Toilet Paper Mega" },
        { id: "item_toilet_paper_roll_empty", displayName: "Toilet Paper Roll Empty" },
        { id: "item_treestick", displayName: "Tree Stick" },
        { id: "item_tripwire_explosive", displayName: "Tripwire Explosive" },
        { id: "item_trophy", displayName: "Trophy" },
        { id: "item_turkey_leg", displayName: "Turkey Leg" },
        { id: "item_turkey_whole", displayName: "Turkey Whole" },
        { id: "item_umbrella", displayName: "Umbrella" },
        { id: "item_umbrella_clover", displayName: "Umbrella Clover" },
        { id: "item_unidentified", displayName: "Unidentified" },
        { id: "item_upsidedown_loot", displayName: "Upside Down Loot" },
        { id: "item_uranium_chunk_l", displayName: "Uranium Chunk L" },
        { id: "item_uranium_chunk_m", displayName: "Uranium Chunk M" },
        { id: "item_uranium_chunk_s", displayName: "Uranium Chunk S" },
        { id: "item_whoopie", displayName: "Whoopie" },
        { id: "item_zipline_gun", displayName: "Zipline Gun" },
      ];

      const backpacks = [
        "item_backpack",
        "item_backpack_black",
        "item_backpack_green",
        "item_backpack_large_base",
        "item_backpack_large_basketball",
        "item_backpack_large_clover",
        "item_backpack_pink",
        "item_backpack_small_base",
        "item_backpack_white",
        "item_backpack_with_flashlight",
        "item_quiver",
        "item_quiver_heart",
      ];

      const weaponsWithAmmo = [
        "item_heart_gun",
        "item_crossbow",
      ];

      // Initialize Monaco Editors
      const loaderScript = document.createElement("script");
      loaderScript.src = "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js";
      loaderScript.onload = function () {
        window.require.config({
          paths: {
            vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs",
          },
        });

        window.require(["vs/editor/editor.main"], function () {
          blockEditor = monaco.editor.create(document.getElementById("blockEditor"), {
            value: "{}",
            language: "json",
            theme: "vs",
            fontSize: 16,
            lineHeight: 24,
            minimap: { enabled: true },
            lineNumbers: "on",
            wordWrap: "off",
            autoClosingBrackets: "always",
            readOnly: false, // Allow editing
          });

          const schema = {
            type: "object",
            properties: {
              version: { type: "number" },
              back: { $ref: "#/definitions/item" },
              leftHand: { $ref: "#/definitions/item" },
              rightHand: { $ref: "#/definitions/item" },
              leftHip: { $ref: "#/definitions/item" },
              rightHip: { $ref: "#/definitions/item" },
            },
            definitions: {
              item: {
                type: "object",
                properties: {
                  itemID: { type: "string", enum: itemIDs.map(item => item.id) },
                  colorHue: { type: "number" },
                  colorSaturation: { type: "number" },
                  scaleModifier: { type: "number" },
                  children: { type: "array", items: { $ref: "#/definitions/item" } },
                  ammo: { type: "number" },
                },
                required: ["itemID"],
              },
            },
          };

          manualEditor = monaco.editor.create(document.getElementById("manualEditor"), {
            value: JSON.stringify({ version: 1 }, null, 2),
            language: "json",
            theme: "vs",
            fontSize: 16,
            lineHeight: 24,
            minimap: { enabled: true },
            lineNumbers: "on",
            wordWrap: "off",
            autoClosingBrackets: "always",
            suggest: {
              showWords: true,
              showFields: true,
              showValues: true,
            },
          });

          monaco.languages.json.jsonDefaults.setDiagnosticsOptions({
            validate: true,
            schemas: [
              {
                uri: "http://myschema/item-forge",
                fileMatch: ["*"],
                schema: schema,
              },
            ],
          });

          // Event listeners for block editor settings
          document.getElementById("editorTheme").addEventListener("change", (e) => {
            monaco.editor.setTheme(e.target.value);
          });

          document.getElementById("fontSize").addEventListener("input", (e) => {
            blockEditor.updateOptions({ fontSize: parseInt(e.target.value) });
          });

          document.getElementById("lineHeight").addEventListener("input", (e) => {
            blockEditor.updateOptions({ lineHeight: parseInt(e.target.value) });
          });

          document.getElementById("minimap").addEventListener("change", (e) => {
            blockEditor.updateOptions({ minimap: { enabled: e.target.value === "true" } });
          });

          document.getElementById("lineNumbers").addEventListener("change", (e) => {
            blockEditor.updateOptions({ lineNumbers: e.target.value });
          });

          document.getElementById("wordWrap").addEventListener("change", (e) => {
            blockEditor.updateOptions({ wordWrap: e.target.value });
          });

          document.getElementById("autoClosingBrackets").addEventListener("change", (e) => {
            blockEditor.updateOptions({ autoClosingBrackets: e.target.value });
          });

          // Event listeners for manual editor settings
          document.getElementById("manualEditorTheme").addEventListener("change", (e) => {
            monaco.editor.setTheme(e.target.value);
          });

          document.getElementById("manualFontSize").addEventListener("input", (e) => {
            manualEditor.updateOptions({ fontSize: parseInt(e.target.value) });
          });

          document.getElementById("manualLineHeight").addEventListener("input", (e) => {
            manualEditor.updateOptions({ lineHeight: parseInt(e.target.value) });
          });

          document.getElementById("manualMinimap").addEventListener("change", (e) => {
            manualEditor.updateOptions({ minimap: { enabled: e.target.value === "true" } });
          });

          document.getElementById("manualLineNumbers").addEventListener("change", (e) => {
            manualEditor.updateOptions({ lineNumbers: e.target.value });
          });

          document.getElementById("manualWordWrap").addEventListener("change", (e) => {
            manualEditor.updateOptions({ wordWrap: e.target.value });
          });

          document.getElementById("manualAutoClosingBrackets").addEventListener("change", (e) => {
            manualEditor.updateOptions({ autoClosingBrackets: e.target.value });
          });
        });
      };
      document.head.appendChild(loaderScript);

      function initializeItemData() {
        slots.forEach(slot => {
          itemData[slot] = { itemID: "None", colorHue: 0, colorSaturation: 0, scaleModifier: 1, children: [], ammo: 0 };
        });
      }

      function selectSlot(slotElement) {
        document.querySelectorAll(".slot").forEach(s => s.classList.remove("selected"));
        slotElement.classList.add("selected");
        selectedSlot = slotElement.dataset.slot;
        updatePropertiesPanel();
      }

      function addItem(itemID) {
        if (!selectedSlot) {
          alert("Please select a slot first.");
          return;
        }
        if (itemData[selectedSlot].itemID !== "None") {
          alert("This slot already has an item. Remove it first to add a different item.");
          return;
        }
        const item = itemIDs.find(i => i.id === itemID);
        itemData[selectedSlot] = {
          itemID,
          displayName: item.displayName,
          colorHue: 0,
          colorSaturation: 0,
          scaleModifier: 1,
          children: Array(item.capacity || 0).fill(null).map(() => ({ itemID: "None", displayName: "Empty", colorHue: 0, colorSaturation: 0, scaleModifier: 1 })),
          ammo: 0,
        };
        updateSlotDisplay(selectedSlot);
        updatePropertiesPanel();
      }

      function addPresetItem(itemID) {
        if (!selectedSlot) {
          alert("Please select a slot first.");
          return;
        }
        if (itemData[selectedSlot].itemID !== "None") {
          alert("This slot already has an item. Remove it first to add a different item.");
          return;
        }
        addItem(itemID);
      }

      function openBackpackModal() {
        if (!selectedSlot) {
          alert("Please select a slot first.");
          return;
        }
        if (itemData[selectedSlot].itemID !== "None") {
          alert("This slot already has an item. Remove it first to add a different item.");
          return;
        }
        const modal = document.getElementById("backpackModal");
        const backpackList = document.getElementById("backpackList");
        backpackList.innerHTML = "";
        backpacks.forEach(backpackID => {
          const item = itemIDs.find(i => i.id === backpackID);
          const div = document.createElement("div");
          div.className = "backpack-option";
          div.textContent = item.displayName;
          div.onclick = () => {
            addItem(backpackID);
            closeModal("backpackModal");
          };
          backpackList.appendChild(div);
        });
        modal.style.display = "flex";
      }

      function viewContent(slot) {
        const modal = document.getElementById("contentModal");
        const modalTitle = document.getElementById("contentModalTitle");
        const modalBody = document.getElementById("contentModalBody");
        const item = itemData[slot];

        modalTitle.textContent = `${item.displayName} Contents`;
        modalBody.innerHTML = "";

        if (backpacks.includes(item.itemID)) {
          const slotsDiv = document.createElement("div");
          slotsDiv.className = "backpack-slots";
          const capacity = itemIDs.find(i => i.id === item.itemID).capacity || 0;
          for (let i = 0; i < capacity; i++) {
            const child = item.children[i] || { itemID: "None", displayName: "Empty", colorHue: 0, colorSaturation: 0, scaleModifier: 1 };
            const slotDiv = document.createElement("div");
            slotDiv.className = "backpack-slot";
            slotDiv.innerHTML = `
              <div>${child.displayName}</div>
              <button class="btn" onclick="addItemToBackpack('${slot}', ${i})">Add Item</button>
              ${child.itemID !== "None" ? `<button class="btn remove-btn" onclick="removeItemFromBackpack('${slot}', ${i})">Remove</button>` : ""}
              ${weaponsWithAmmo.includes(child.itemID) ? `<button class="btn view-btn" onclick="viewNestedContent('${slot}', ${i})">View Content</button>` : ""}
            `;
            slotsDiv.appendChild(slotDiv);
          }
          modalBody.appendChild(slotsDiv);
        } else if (weaponsWithAmmo.includes(item.itemID)) {
          const propertiesDiv = document.createElement("div");
          propertiesDiv.className = "nested-item-properties";
          propertiesDiv.innerHTML = `
            <div class="property-group">
              <label>Ammo (0-10)</label>
              <div class="input-wrapper">
                <input type="range" class="ammo" min="0" max="10" value="${item.ammo || 0}">
                <input type="number" class="ammo-text" min="0" max="10" value="${item.ammo || 0}">
              </div>
            </div>
          `;
          modalBody.appendChild(propertiesDiv);
          const ammoSlider = propertiesDiv.querySelector(".ammo");
          const ammoText = propertiesDiv.querySelector(".ammo-text");
          ammoSlider.addEventListener("input", (e) => {
            itemData[slot].ammo = parseInt(e.target.value);
            ammoText.value = e.target.value;
          });
          ammoText.addEventListener("input", (e) => {
            let value = parseInt(e.target.value);
            if (isNaN(value)) value = 0;
            if (value < 0) value = 0;
            if (value > 10) value = 10;
            itemData[slot].ammo = value;
            ammoSlider.value = value;
            e.target.value = value;
          });
        }

        modal.style.display = "flex";
      }

      function viewNestedContent(slot, index) {
        const modal = document.getElementById("contentModal");
        const modalTitle = document.getElementById("contentModalTitle");
        const modalBody = document.getElementById("contentModalBody");
        const item = itemData[slot].children[index];

        modalTitle.textContent = `${item.displayName} Contents`;
        modalBody.innerHTML = "";

        if (weaponsWithAmmo.includes(item.itemID)) {
          const propertiesDiv = document.createElement("div");
          propertiesDiv.className = "nested-item-properties";
          propertiesDiv.innerHTML = `
            <div class="property-group">
              <label>Ammo (0-10)</label>
              <div class="input-wrapper">
                <input type="range" class="ammo" min="0" max="10" value="${item.ammo || 0}">
                <input type="number" class="ammo-text" min="0" max="10" value="${item.ammo || 0}">
              </div>
            </div>
          `;
          modalBody.appendChild(propertiesDiv);
          const ammoSlider = propertiesDiv.querySelector(".ammo");
          const ammoText = propertiesDiv.querySelector(".ammo-text");
          ammoSlider.addEventListener("input", (e) => {
            itemData[slot].children[index].ammo = parseInt(e.target.value);
            ammoText.value = e.target.value;
          });
          ammoText.addEventListener("input", (e) => {
            let value = parseInt(e.target.value);
            if (isNaN(value)) value = 0;
            if (value < 0) value = 0;
            if (value > 10) value = 10;
            itemData[slot].children[index].ammo = value;
            ammoSlider.value = value;
            e.target.value = value;
          });
        }

        modal.style.display = "flex";
      }

      function addItemToBackpack(slot, index) {
        const modal = document.getElementById("contentModal");
        const modalBody = document.getElementById("contentModalBody");
        modalBody.innerHTML = `<h3>Select Item for Slot ${index + 1}</h3>`;
        const itemList = document.createElement("div");
        itemList.className = "item-list";
        itemIDs.forEach(item => {
          if (item.id === "None" || backpacks.includes(item.id)) return;
          const div = document.createElement("div");
          div.textContent = item.displayName;
          div.onclick = () => {
            if (!itemData[slot].children[index]) {
              itemData[slot].children[index] = {
                itemID: item.id,
                displayName: item.displayName,
                colorHue: 0,
                colorSaturation: 0,
                scaleModifier: 1,
              };
            } else {
              itemData[slot].children[index] = {
                itemID: item.id,
                displayName: item.displayName,
                colorHue: 0,
                colorSaturation: 0,
                scaleModifier: 1,
              };
            }
            viewContent(slot);
          };
          itemList.appendChild(div);
        });
        modalBody.appendChild(itemList);
      }

      function removeItemFromBackpack(slot, index) {
        itemData[slot].children[index] = { itemID: "None", displayName: "Empty", colorHue: 0, colorSaturation: 0, scaleModifier: 1 };
        viewContent(slot);
      }

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }

      function removeItem(slot) {
        itemData[slot] = { itemID: "None", colorHue: 0, colorSaturation: 0, scaleModifier: 1, children: [], ammo: 0 };
        updateSlotDisplay(slot);
        updatePropertiesPanel();
      }

      function updateSlotDisplay(slot) {
        const slotElement = document.querySelector(`.slot[data-slot="${slot}"]`);
        const item = itemData[slot];
        if (item.itemID === "None") {
          slotElement.querySelector("div").innerHTML = "Empty";
        } else {
          const hasContent = backpacks.includes(item.itemID) || weaponsWithAmmo.includes(item.itemID);
          slotElement.querySelector("div").innerHTML = `
            <span class="item">${item.displayName}</span>
            <div>
              <button class="remove-btn" onclick="removeItem('${slot}')">Remove</button>
              ${hasContent ? `<button class="view-btn" onclick="viewContent('${slot}')">View Content</button>` : ""}
            </div>
          `;
        }
      }

      function updatePropertiesPanel() {
        const propertiesContent = document.getElementById("propertiesContent");
        if (!selectedSlot || itemData[selectedSlot].itemID === "None") {
          propertiesContent.innerHTML = "Select an item to edit its properties";
          return;
        }
        const item = itemData[selectedSlot];
        propertiesContent.innerHTML = `
          <div class="property-group">
            <label>${item.displayName}</label>
          </div>
          <div class="property-group">
            <label>Color Hue (0-360)</label>
            <div class="input-wrapper">
              <input type="range" class="hue" min="0" max="360" value="${item.colorHue}">
              <input type="number" class="hue-text" min="0" max="360" value="${item.colorHue}">
            </div>
          </div>
          <div class="property-group">
            <label>Color Saturation (0-100)</label>
            <div class="input-wrapper">
              <input type="range" class="saturation" min="0" max="100" value="${item.colorSaturation}">
              <input type="number" class="saturation-text" min="0" max="100" value="${item.colorSaturation}">
            </div>
          </div>
          <div class="property-group">
            <label>Scale Modifier (-128 to 127)</label>
            <div class="input-wrapper">
              <input type="range" class="scale" min="-128" max="127" step="1" value="${item.scaleModifier}">
              <input type="number" class="scale-text" min="-128" max="127" value="${item.scaleModifier}">
            </div>
          </div>
        `;
        const hueSlider = propertiesContent.querySelector(".hue");
        const hueText = propertiesContent.querySelector(".hue-text");
        const saturationSlider = propertiesContent.querySelector(".saturation");
        const saturationText = propertiesContent.querySelector(".saturation-text");
        const scaleSlider = propertiesContent.querySelector(".scale");
        const scaleText = propertiesContent.querySelector(".scale-text");

        hueSlider.addEventListener("input", (e) => {
          itemData[selectedSlot].colorHue = parseFloat(e.target.value);
          hueText.value = e.target.value;
        });
        hueText.addEventListener("input", (e) => {
          let value = parseFloat(e.target.value);
          if (isNaN(value)) value = 0;
          if (value < 0) value = 0;
          if (value > 360) value = 360;
          itemData[selectedSlot].colorHue = value;
          hueSlider.value = value;
          e.target.value = value;
        });

        saturationSlider.addEventListener("input", (e) => {
          itemData[selectedSlot].colorSaturation = parseFloat(e.target.value);
          saturationText.value = e.target.value;
        });
        saturationText.addEventListener("input", (e) => {
          let value = parseFloat(e.target.value);
          if (isNaN(value)) value = 0;
          if (value < 0) value = 0;
          if (value > 100) value = 100;
          itemData[selectedSlot].colorSaturation = value;
          saturationSlider.value = value;
          e.target.value = value;
        });

        scaleSlider.addEventListener("input", (e) => {
          itemData[selectedSlot].scaleModifier = parseFloat(e.target.value);
          scaleText.value = e.target.value;
        });
        scaleText.addEventListener("input", (e) => {
          let value = parseFloat(e.target.value);
          if (isNaN(value)) value = 1;
          if (value < -128) value = -128;
          if (value > 127) value = 127;
          itemData[selectedSlot].scaleModifier = value;
          scaleSlider.value = value;
          e.target.value = value;
        });
      }

      function applyColorPreset(hue, sat) {
        if (!selectedSlot || itemData[selectedSlot].itemID === "None") return;
        itemData[selectedSlot].colorHue = parseFloat(hue);
        itemData[selectedSlot].colorSaturation = parseFloat(sat);
        updatePropertiesPanel();
      }

      function filterItems() {
        const searchTerm = document.getElementById("searchItemID").value.toLowerCase();
        const itemList = document.getElementById("itemList");
        itemList.innerHTML = "";
        itemIDs.forEach(item => {
          if (item.id === "None") return;
          if (!item.displayName.toLowerCase().includes(searchTerm)) return;
          const div = document.createElement("div");
          div.textContent = item.displayName;
          div.onclick = () => addItem(item.id);
          itemList.appendChild(div);
        });
      }

      function generateJSON() {
        const result = { version: 1 };
        slots.forEach(slot => {
          const item = itemData[slot];
          if (item.itemID !== "None") {
            const itemEntry = { itemID: item.itemID };
            if (item.colorHue !== 0) itemEntry.colorHue = item.colorHue;
            if (item.colorSaturation !== 0) itemEntry.colorSaturation = item.colorSaturation;
            if (item.scaleModifier !== 1) itemEntry.scaleModifier = item.scaleModifier;
            if (item.children && item.children.length) {
              itemEntry.children = item.children
                .filter(child => child.itemID !== "None")
                .map(child => {
                  const childEntry = { itemID: child.itemID };
                  if (child.colorHue !== 0) childEntry.colorHue = child.colorHue;
                  if (child.colorSaturation !== 0) childEntry.colorSaturation = child.colorSaturation;
                  if (child.scaleModifier !== 1) childEntry.scaleModifier = child.scaleModifier;
                  return childEntry;
                });
              if (!itemEntry.children.length) delete itemEntry.children;
            }
            if (item.ammo !== 0) itemEntry.ammo = item.ammo;
            result[slot] = itemEntry;
          }
        });
        const jsonString = JSON.stringify(result, null, 2);
        blockEditor.setValue(jsonString);
      }

      function downloadJSON() {
        const json = blockEditor.getValue();
        if (!json) return alert("Generate JSON first.");
        const blob = new Blob([json], { type: "application/json" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "item_forge.json";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function downloadManualJSON() {
        const json = manualEditor.getValue();
        if (!json) return alert("No JSON data to download.");
        try {
          JSON.parse(json);
          const blob = new Blob([json], { type: "application/json" });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = "manual_item_forge.json";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        } catch (err) {
          alert("Invalid JSON format. Please check your input.");
        }
      }

      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const json = JSON.parse(e.target.result);
            importJSON(json);
          } catch (err) {
            alert("Invalid JSON file.");
          }
        };
        reader.readAsText(file);
        event.target.value = "";
      }

      function handleManualFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const json = JSON.parse(e.target.result);
            manualEditor.setValue(JSON.stringify(json, null, 2));
          } catch (err) {
            alert("Invalid JSON file.");
          }
        };
        reader.readAsText(file);
        event.target.value = "";
      }

      function importJSON(json) {
        slots.forEach(slot => {
          if (json[slot]) {
            const item = itemIDs.find(i => i.id === json[slot].itemID);
            const capacity = item ? (item.capacity || 0) : 0;
            itemData[slot] = {
              itemID: json[slot].itemID || "None",
              displayName: item ? item.displayName : "Unknown",
              colorHue: json[slot].colorHue || 0,
              colorSaturation: json[slot].colorSaturation || 0,
              scaleModifier: json[slot].scaleModifier || 1,
              children: json[slot].children ? json[slot].children.map(child => {
                const childItem = itemIDs.find(i => i.id === child.itemID);
                return {
                  itemID: child.itemID,
                  displayName: childItem ? childItem.displayName : "Unknown",
                  colorHue: child.colorHue || 0,
                  colorSaturation: child.colorSaturation || 0,
                  scaleModifier: child.scaleModifier || 1,
                };
              }) : Array(capacity).fill(null).map(() => ({ itemID: "None", displayName: "Empty", colorHue: 0, colorSaturation: 0, scaleModifier: 1 })),
              ammo: json[slot].ammo || 0,
            };
          } else {
            itemData[slot] = { itemID: "None", colorHue: 0, colorSaturation: 0, scaleModifier: 1, children: [], ammo: 0 };
          }
          updateSlotDisplay(slot);
        });
        updatePropertiesPanel();
        generateJSON();
      }

      function switchTab(tabName) {
        document.querySelectorAll(".tab-content").forEach(content => {
          content.classList.remove("active");
        });
        document.querySelectorAll(".tab-btn").forEach(btn => {
          btn.classList.remove("active");
        });
        document.getElementById(tabName).classList.add("active");
        document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add("active");

        if (tabName === "blockBuilder") {
          const loadingScreen = document.getElementById("loadingScreen");
          loadingScreen.style.display = "flex";
          setTimeout(() => {
            loadingScreen.style.display = "none";
          }, 1000);
        }
      }

      window.onload = () => {
        initializeItemData();
        document.querySelectorAll(".slot").forEach(slot => {
          slot.addEventListener("click", () => selectSlot(slot));
        });
        document.getElementById("searchItemID").addEventListener("input", filterItems);
        document.querySelectorAll(".color-preset").forEach(preset => {
          preset.addEventListener("click", () => {
            const hue = preset.dataset.hue;
            const sat = preset.dataset.sat;
            applyColorPreset(hue, sat);
          });
        });
        filterItems();
        document.querySelectorAll(".tab-btn").forEach(btn => {
          btn.addEventListener("click", () => switchTab(btn.dataset.tab));
        });
      };
    </script>
  </body>
</html>
